{"ast":null,"code":"import { useCallback, useEffect, useState } from 'react';\nimport { useActiveWeb3React } from '../../hooks';\nimport useDebounce from '../../hooks/useDebounce';\nimport useIsWindowVisible from '../../hooks/useIsWindowVisible';\nimport { updateBlockNumber } from './actions';\nimport { useDispatch } from 'react-redux';\nexport default function Updater() {\n  const {\n    library,\n    chainId\n  } = useActiveWeb3React();\n  const dispatch = useDispatch();\n  const windowVisible = useIsWindowVisible();\n  const [state, setState] = useState({\n    chainId,\n    blockNumber: null\n  });\n  const blockNumberCallback = useCallback(blockNumber => {\n    setState(state => {\n      if (chainId === state.chainId) {\n        if (typeof state.blockNumber !== 'number') return {\n          chainId,\n          blockNumber\n        };\n        return {\n          chainId,\n          blockNumber: Math.max(blockNumber, state.blockNumber)\n        };\n      }\n\n      return state;\n    });\n  }, [chainId, setState]); // attach/detach listeners\n\n  useEffect(() => {\n    if (!library || !chainId || !windowVisible) return undefined;\n    setState({\n      chainId,\n      blockNumber: null\n    });\n    library.getBlockNumber().then(blockNumberCallback).catch(error => console.error(`Failed to get block number for chainId: ${chainId}`, error));\n    library.on('block', blockNumberCallback);\n    return () => {\n      library.removeListener('block', blockNumberCallback);\n    };\n  }, [dispatch, chainId, library, blockNumberCallback, windowVisible]);\n  const debouncedState = useDebounce(state, 100);\n  useEffect(() => {\n    if (!debouncedState.chainId || !debouncedState.blockNumber || !windowVisible) return;\n    dispatch(updateBlockNumber({\n      chainId: debouncedState.chainId,\n      blockNumber: debouncedState.blockNumber\n    }));\n  }, [windowVisible, dispatch, debouncedState.blockNumber, debouncedState.chainId]);\n  return null;\n}","map":{"version":3,"sources":["/Users/sidshekhar/Documents/interface/src/state/application/updater.ts"],"names":["useCallback","useEffect","useState","useActiveWeb3React","useDebounce","useIsWindowVisible","updateBlockNumber","useDispatch","Updater","library","chainId","dispatch","windowVisible","state","setState","blockNumber","blockNumberCallback","Math","max","undefined","getBlockNumber","then","catch","error","console","on","removeListener","debouncedState"],"mappings":"AAAA,SAASA,WAAT,EAAsBC,SAAtB,EAAiCC,QAAjC,QAAiD,OAAjD;AACA,SAASC,kBAAT,QAAmC,aAAnC;AACA,OAAOC,WAAP,MAAwB,yBAAxB;AACA,OAAOC,kBAAP,MAA+B,gCAA/B;AACA,SAASC,iBAAT,QAAkC,WAAlC;AACA,SAASC,WAAT,QAA4B,aAA5B;AAEA,eAAe,SAASC,OAAT,GAAyB;AACtC,QAAM;AAAEC,IAAAA,OAAF;AAAWC,IAAAA;AAAX,MAAuBP,kBAAkB,EAA/C;AACA,QAAMQ,QAAQ,GAAGJ,WAAW,EAA5B;AAEA,QAAMK,aAAa,GAAGP,kBAAkB,EAAxC;AAEA,QAAM,CAACQ,KAAD,EAAQC,QAAR,IAAoBZ,QAAQ,CAA8D;AAC9FQ,IAAAA,OAD8F;AAE9FK,IAAAA,WAAW,EAAE;AAFiF,GAA9D,CAAlC;AAKA,QAAMC,mBAAmB,GAAGhB,WAAW,CACpCe,WAAD,IAAyB;AACvBD,IAAAA,QAAQ,CAACD,KAAK,IAAI;AAChB,UAAIH,OAAO,KAAKG,KAAK,CAACH,OAAtB,EAA+B;AAC7B,YAAI,OAAOG,KAAK,CAACE,WAAb,KAA6B,QAAjC,EAA2C,OAAO;AAAEL,UAAAA,OAAF;AAAWK,UAAAA;AAAX,SAAP;AAC3C,eAAO;AAAEL,UAAAA,OAAF;AAAWK,UAAAA,WAAW,EAAEE,IAAI,CAACC,GAAL,CAASH,WAAT,EAAsBF,KAAK,CAACE,WAA5B;AAAxB,SAAP;AACD;;AACD,aAAOF,KAAP;AACD,KANO,CAAR;AAOD,GAToC,EAUrC,CAACH,OAAD,EAAUI,QAAV,CAVqC,CAAvC,CAXsC,CAwBtC;;AACAb,EAAAA,SAAS,CAAC,MAAM;AACd,QAAI,CAACQ,OAAD,IAAY,CAACC,OAAb,IAAwB,CAACE,aAA7B,EAA4C,OAAOO,SAAP;AAE5CL,IAAAA,QAAQ,CAAC;AAAEJ,MAAAA,OAAF;AAAWK,MAAAA,WAAW,EAAE;AAAxB,KAAD,CAAR;AAEAN,IAAAA,OAAO,CACJW,cADH,GAEGC,IAFH,CAEQL,mBAFR,EAGGM,KAHH,CAGSC,KAAK,IAAIC,OAAO,CAACD,KAAR,CAAe,2CAA0Cb,OAAQ,EAAjE,EAAoEa,KAApE,CAHlB;AAKAd,IAAAA,OAAO,CAACgB,EAAR,CAAW,OAAX,EAAoBT,mBAApB;AACA,WAAO,MAAM;AACXP,MAAAA,OAAO,CAACiB,cAAR,CAAuB,OAAvB,EAAgCV,mBAAhC;AACD,KAFD;AAGD,GAdQ,EAcN,CAACL,QAAD,EAAWD,OAAX,EAAoBD,OAApB,EAA6BO,mBAA7B,EAAkDJ,aAAlD,CAdM,CAAT;AAgBA,QAAMe,cAAc,GAAGvB,WAAW,CAACS,KAAD,EAAQ,GAAR,CAAlC;AAEAZ,EAAAA,SAAS,CAAC,MAAM;AACd,QAAI,CAAC0B,cAAc,CAACjB,OAAhB,IAA2B,CAACiB,cAAc,CAACZ,WAA3C,IAA0D,CAACH,aAA/D,EAA8E;AAC9ED,IAAAA,QAAQ,CAACL,iBAAiB,CAAC;AAAEI,MAAAA,OAAO,EAAEiB,cAAc,CAACjB,OAA1B;AAAmCK,MAAAA,WAAW,EAAEY,cAAc,CAACZ;AAA/D,KAAD,CAAlB,CAAR;AACD,GAHQ,EAGN,CAACH,aAAD,EAAgBD,QAAhB,EAA0BgB,cAAc,CAACZ,WAAzC,EAAsDY,cAAc,CAACjB,OAArE,CAHM,CAAT;AAKA,SAAO,IAAP;AACD","sourcesContent":["import { useCallback, useEffect, useState } from 'react'\nimport { useActiveWeb3React } from '../../hooks'\nimport useDebounce from '../../hooks/useDebounce'\nimport useIsWindowVisible from '../../hooks/useIsWindowVisible'\nimport { updateBlockNumber } from './actions'\nimport { useDispatch } from 'react-redux'\n\nexport default function Updater(): null {\n  const { library, chainId } = useActiveWeb3React()\n  const dispatch = useDispatch()\n\n  const windowVisible = useIsWindowVisible()\n\n  const [state, setState] = useState<{ chainId: number | undefined; blockNumber: number | null }>({\n    chainId,\n    blockNumber: null\n  })\n\n  const blockNumberCallback = useCallback(\n    (blockNumber: number) => {\n      setState(state => {\n        if (chainId === state.chainId) {\n          if (typeof state.blockNumber !== 'number') return { chainId, blockNumber }\n          return { chainId, blockNumber: Math.max(blockNumber, state.blockNumber) }\n        }\n        return state\n      })\n    },\n    [chainId, setState]\n  )\n\n  // attach/detach listeners\n  useEffect(() => {\n    if (!library || !chainId || !windowVisible) return undefined\n\n    setState({ chainId, blockNumber: null })\n\n    library\n      .getBlockNumber()\n      .then(blockNumberCallback)\n      .catch(error => console.error(`Failed to get block number for chainId: ${chainId}`, error))\n\n    library.on('block', blockNumberCallback)\n    return () => {\n      library.removeListener('block', blockNumberCallback)\n    }\n  }, [dispatch, chainId, library, blockNumberCallback, windowVisible])\n\n  const debouncedState = useDebounce(state, 100)\n\n  useEffect(() => {\n    if (!debouncedState.chainId || !debouncedState.blockNumber || !windowVisible) return\n    dispatch(updateBlockNumber({ chainId: debouncedState.chainId, blockNumber: debouncedState.blockNumber }))\n  }, [windowVisible, dispatch, debouncedState.blockNumber, debouncedState.chainId])\n\n  return null\n}\n"]},"metadata":{},"sourceType":"module"}